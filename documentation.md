# Назначение проекта
Веб приложение созданное для записи на НРИ (настольные ролевые игры) в формате схожем с форматом west march (большое количество игроков, один или несколько ведущих). 
Игрок сможет ознакомиться с списком доступных заданий и окон для записи, после чего отметить свое желание участвовать, указав свой никнейм и дополнительную информацию (например, какого он выберет персонажа).
Ведущий может узнать на какое время собралось большее количество игроков, какое задание они хотят выполнить и каких персонажей они выбрали.
# Структура сайта
## Структура страниц
### Главная страница
На главной странице представлено краткое описание проекта.
Далее идет список доступных заданий.
При переходе на любое задание можно ознакомиться с детальной информацией о нем и записаться на него, указав возможно время в календаре на любую дату, даже если на ней не указанно окно. 
При записи игрок указывает дату игры и диапазон времени, когда он свободен. 
Также он может указать комментарий, чтобы отметить опциональную информацию.
При указании диапазона времени время конца автоматически выставляется на +5 часов от установленного пользователь времени начала, это значение пользователь может изменить вручную.
### Админ панель
В админ панели могут находиться только мастера. Ввиду малого размера проекта и доверия собственной аудитории первая версия не будет использовать механизмов авторизации и аутентификации. 
#### Админ панель. Мониторинг
Панель мониторинга содержит основную информацию о текущем состоянии сайта. 
Отображаются следующие данные:
1. Количество активных заданий
2. Количество заявок
3. Топ 10 ближайших по времени заявок со статусом confirmed 
4. Топ 5 самых популярных заданий (больше всего заявок на это задание)
5. Топ 5 самых популярных дат для игры (больше всего заявок на эту дату)

А также кнопки для переадресации на страницы:
1. **Админ панель. Задания**
2. **Админ панель. Заявки**. 
3. **Админ панель. Окна**
#### Админ панель. Задания
Страница позволяет создавать, удалять и просматривать все задания.

Задания должны отображаться списком, на карточке каждого задания указано его название, тэги, уровень и количество откликов. 
При нажатии на задание открывается детальное отображение/редактор. В этом отображении можно редактировать все неслужебные поля задания (не id и created_at). 
Также рядом отображаются заявки в формате: **номер заявки**, **время создания заявки**, **имя**, **комментарий**. 

Структура данных **задание**: 

| Поле              | Тип      | Null | Описание                                    |
| ----------------- | -------- | ---- | ------------------------------------------- |
| id                | int      | no   | Уникальный идентификатор                    |
| name              | string   | no   | Имя задания                                 |
| short_description | string   | no   | Короткое описание задания                   |
| description       | string   | no   | Полное описание задания                     |
| min_lvl           | int      | yes  | Минимальный уровень для выполнения задания  |
| max_lvl           | int      | yes  | Максимальный уровень для выполнения задания |
| tags              | string[] | yes  | Тэги для задания                            |
| created_at        | date     | no   | время создания задания                      |
#### Админ панель. Заявки
Страница позволяет просматривать и удалять заявки. 

Структура данных **Зявка**:

| Поле       | Тип    | Null | Описание                                          |
| ---------- | ------ | ---- | ------------------------------------------------- |
| id         | int    | no   | Уникальный идентификатор                          |
| created_at | date   | no   | время создания задания                            |
| name       | string | no   | имя инициатора заявки                             |
| info       | string | yes  | комментарий оставленный пользователем             |
| game_date  | date   | no   | Дата указанная пользователем                      |
| time_start | time   | yes  | время начала "окна"                               |
| time_end   | time   | yes  | время конца "окна"                                |
| status     | string | no   | Статус заявки. "outdated", "confirmed", "default" |
#### Админ панель. Окна
Позволяет настроить свободные для игры временные окна. Представляет собой календарь, в котором можно отметить свободную дату. Она будет отображаться у обычных пользователей как зеленая обводка в таблице при выборе даты для заявки.

| Поле       | Тип  | Null | Описание                     |
| ---------- | ---- | ---- | ---------------------------- |
| id         | int  | no   | Уникальный идентификатор     |
| game_date  | date | no   | Дата указанная пользователем |
| time_start | time | yes  | время начала "окна"          |
| time_end   | time | yes  | время конца "окна"           |
## Структура api

### Публичные endpoint

| Метод | Путь (Endpoint)   | Описание                                                                                                                                                      |
| ----- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GET   | /api/tasks        | Получить список всех активных заданий. Возвращает поля с краткой информацией (название, тэги, уровень, количество откликов).                                  |
| GET   | /api/tasks/<id>   | Получить детальную информацию о конкретном задании.                                                                                                           |
| POST  | /api/applications | Создать новую заявку на участие в игре. Игрок передает данные: name, game_date, time_start, time_end, info (комментарий), и обязательно task_id (ID задания). |
| GET   | /api/windows      | Получить список доступных свободных временных окон, настроенных мастером, для отображения зеленой обводки на календаре.                                       |
### Приватные endpoint
#### Главная админ панели

| Метод | Путь (Endpoint)      | Описание                                                                                                                                                                                                                                                                             |
| ----- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| GET   | /api/admin/dashboard | Получить все данные для отображения на Панели мониторинга: <ul><li>Количество активных заданий.</li><li>Количество всех заявок.</li><li>Топ 10 ближайших по времени confirmed заявок.</li><li>Топ 5 самых популярных заданий.</li><li>Топ 5 самых популярных дат для игры.</li></ul> |
#### Управление заданиями

| Метод  | Путь (Endpoint)       | Описание                                                                                      |
| ------ | --------------------- | --------------------------------------------------------------------------------------------- |
| GET    | /api/admin/tasks      | Получить полный список всех заданий с деталями (для отображения на странице управления).      |
| POST   | /api/admin/tasks      | Создать новое задание. Мастер передает все неслужебные поля (name, description, tags и т.д.). |
| GET    | /api/admin/tasks/<id> | Получить детальное отображение задания, включая связанные заявки.                             |
| PUT    | /api/admin/tasks/<id> | Обновить (редактировать) существующее задание.                                                |
| DELETE | /api/admin/tasks/<id> | Удалить задание.                                                                              |
#### Управление заявками

| Метод  | Путь (Endpoint)              | Описание                                                             |
| ------ | ---------------------------- | -------------------------------------------------------------------- |
| GET    | /api/admin/applications      | Получить полный список всех заявок (для страницы управления).        |
| PUT    | /api/admin/applications/<id> | Обновить статус заявки (status: "confirmed", "outdated", "default"). |
| DELETE | /api/admin/applications/<id> | Удалить заявку.                                                      |
#### Управление Окнами

| Метод  | Путь (Endpoint)         | Описание                                                   |
| ------ | ----------------------- | ---------------------------------------------------------- |
| GET    | /api/admin/windows      | Получить список всех настроенных свободных окон.           |
| POST   | /api/admin/windows      | Создать новое временное окно (date, time_start, time_end). |
| DELETE | /api/admin/windows/<id> | Удалить временное окно.                                    |

## Структура API (Расширенный раздел)

### Публичные Endpoint

#### 1. Получить список всех активных заданий

**Метод:** `GET` 
**Путь:** `/api/tasks` 
**Описание:** Возвращает список всех активных заданий с краткой информацией.

**Тело ответа (Response Body - 200 OK):**

```
[
  {
    "id": 101,
    "name": "Поход в Гоблинские шахты",
    "short_description": "Простое задание для новичков...",
    "min_lvl": 1,
    "max_lvl": 3,
    "tags": ["Бой", "Подземелье"],
    "application_count": 5 
  },
  // ... другие задания
]
```

#### 2. Получить детальную информацию о конкретном задании

**Метод:** `GET` 
**Путь:** `/api/tasks/<id>` 
**Описание:** Возвращает полное описание задания.

**Тело ответа (Response Body - 200 OK):**

```
{
  "id": 101,
  "name": "Поход в Гоблинские шахты",
  "short_description": "Простое задание для новичков...",
  "description": "Полное и детальное описание задания, история, вводная информация...",
  "min_lvl": 1,
  "max_lvl": 3,
  "tags": ["Бой", "Подземелье"],
  "created_at": "2025-10-26T10:00:00Z"
}
```

#### 3. Создать новую заявку на участие в игре

**Метод:** `POST` 
**Путь:** `/api/applications` 
**Описание:** Игрок создает заявку на выбранное задание.

**Тело запроса (Request Body):**

**Примечание:** Поля `id`, `created_at`, `status` устанавливаются сервером.

```
{
  "task_id": 101,
  "name": "Кот-Рыболов",
  "info": "Беру своего гнома-воина 'Грута'.",
  "game_date": "2025-11-20", 
  "time_start": "18:00:00",
  "time_end": "23:00:00"
}
```

**Тело ответа (Response Body - 201 Created):**

Возвращает созданный объект `Заявка` со служебными полями.

```
{
  "id": 42,
  "task_id": 101,
  "name": "Кот-Рыболов",
  "info": "Беру своего гнома-воина 'Грута'.",
  "game_date": "2025-11-20", 
  "time_start": "18:00:00",
  "time_end": "23:00:00",
  "status": "default",
  "created_at": "2025-11-04T20:30:00Z"
}
```

#### 4. Получить список доступных свободных временных окон

**Метод:** `GET` **Путь:** `/api/windows` **Описание:** Получить список доступных свободных временных окон, настроенных мастером.

**Тело ответа (Response Body - 200 OK):**

Возвращает массив объектов `Окно`.

```
[
  {
    "id": 1,
    "game_date": "2025-11-15",
    "time_start": "17:00:00",
    "time_end": "23:00:00"
  },
  // ... другие окна
]
```

### Приватные Endpoint (Админ Панель)

#### Главная админ панели

##### Получить данные для Панели мониторинга

**Метод:** `GET` **Путь:** `/api/admin/dashboard` **Описание:** Получить все агрегированные данные для отображения на Панели мониторинга (количество заданий/заявок, топы).

**Тело ответа (Response Body - 200 OK):**

```
{
  "active_tasks_count": 5,
  "total_applications_count": 42,
  "top_confirmed_applications": [
    // Топ 10 ближайших по времени confirmed заявок
    {
      "id": 5, 
      "name": "Игрок А", 
      "game_date": "2025-11-25", 
      "time_start": "19:00:00", 
      "task_name": "Поход в Гоблинские шахты"
    }
    // ... 9 других заявок
  ],
  "top_tasks": [
    // Топ 5 самых популярных заданий
    {"task_id": 101, "task_name": "Поход в Гоблинские шахты", "application_count": 12},
    // ... 4 других задания
  ],
  "top_dates": [
    // Топ 5 самых популярных дат
    {"game_date": "2025-11-30", "application_count": 18},
    // ... 4 других даты
  ]
}
```

#### Управление заданиями

##### Получить полный список всех заданий

**Метод:** `GET` **Путь:** `/api/admin/tasks` **Описание:** Возвращает полный список всех заданий с дополнительными служебными данными (если применимо).

**Тело ответа (Response Body - 200 OK):**

- Возвращает массив объектов `Задание`, дополненный количеством заявок.
    

```
[
  {
    "id": 101,
    "name": "Поход в Гоблинские шахты",
    "short_description": "...",
    "description": "...",
    "min_lvl": 1,
    "max_lvl": 3,
    "tags": ["Бой", "Подземелье"],
    "created_at": "2025-10-26T10:00:00Z",
    "application_count": 12 
  }
  // ... другие задания
]
```

##### Создать новое задание

**Метод:** `POST` **Путь:** `/api/admin/tasks` **Описание:** Создание нового задания.

**Тело запроса (Request Body):**

- Передаются все неслужебные поля объекта `Задание`.
    

```
{
  "name": "Новое приключение: Храм Древнего",
  "short_description": "Сложное задание для опытных игроков.",
  "description": "Полный текст квеста...",
  "min_lvl": 5,
  "max_lvl": 8,
  "tags": ["Мистика", "Головоломки"]
}
```

**Тело ответа (Response Body - 201 Created):**

- Возвращает созданный объект `Задание` со служебными полями.
    

##### Получить детальное отображение задания, включая связанные заявки

**Метод:** `GET` **Путь:** `/api/admin/tasks/<id>` **Описание:** Получение детальной информации о задании и всех заявок, поданных на него.

**Тело ответа (Response Body - 200 OK):**

```
{
  "task": {
    "id": 101,
    "name": "Поход в Гоблинские шахты",
    // ... все остальные поля задания
    "created_at": "2025-10-26T10:00:00Z"
  },
  "applications": [
    {
      "id": 42,
      "created_at": "2025-11-04T20:30:00Z",
      "name": "Кот-Рыболов",
      "info": "Беру своего гнома-воина 'Грута'.",
      "game_date": "2025-11-20", 
      "time_start": "18:00:00",
      "time_end": "23:00:00",
      "status": "confirmed"
    }
    // ... все заявки на это задание
  ]
}
```

##### Обновить (редактировать) существующее задание

**Метод:** `PUT` **Путь:** `/api/admin/tasks/<id>` **Описание:** Обновление одного или нескольких полей задания.

**Тело запроса (Request Body):**

- Передаются только те поля, которые нужно изменить.
    

```
{
  "min_lvl": 2,
  "tags": ["Бой", "Подземелье", "Обновлено"]
}
```

**Тело ответа (Response Body - 200 OK):**

- Возвращает обновленный объект `Задание`.
    

##### Удалить задание

**Метод:** `DELETE` **Путь:** `/api/admin/tasks/<id>` **Описание:** Удаление задания и всех связанных с ним заявок.

**Тело ответа (Response Body - 204 No Content):**

- Успешное удаление.
    

#### Управление заявками

##### Получить полный список всех заявок

**Метод:** `GET` **Путь:** `/api/admin/applications` **Описание:** Получить полный список всех заявок для страницы управления.

**Тело ответа (Response Body - 200 OK):**

- Возвращает массив объектов `Заявка`, дополненный названием задания.
    

```
[
  {
    "id": 42,
    "created_at": "2025-11-04T20:30:00Z",
    "name": "Кот-Рыболов",
    "info": "...",
    "game_date": "2025-11-20",
    "time_start": "18:00:00",
    "time_end": "23:00:00",
    "status": "confirmed",
    "task_id": 101,
    "task_name": "Поход в Гоблинские шахты"
  }
  // ... все заявки
]
```

##### Обновить статус заявки

**Метод:** `PUT` **Путь:** `/api/admin/applications/<id>` **Описание:** Изменение статуса заявки.

**Тело запроса (Request Body):**

- **Примечание:** Допустимые значения статуса: `"outdated"`, `"confirmed"`, `"default"`.
    

```
{
  "status": "confirmed"
}
```

**Тело ответа (Response Body - 200 OK):**

- Возвращает обновленный объект `Заявка`.
    

##### Удалить заявку

**Метод:** `DELETE` **Путь:** `/api/admin/applications/<id>` **Описание:** Удаление заявки.

**Тело ответа (Response Body - 204 No Content):**

- Успешное удаление.
    

#### Управление Окнами

##### Получить список всех настроенных свободных окон

**Метод:** `GET` **Путь:** `/api/admin/windows` **Описание:** Получить список всех свободных временных окон, настроенных мастером.

**Тело ответа (Response Body - 200 OK):**

- Возвращает массив объектов `Окно`.
    

```
[
  {
    "id": 1,
    "game_date": "2025-11-15",
    "time_start": "17:00:00",
    "time_end": "23:00:00"
  },
  // ... другие окна
]
```

##### Создать новое временное окно

**Метод:** `POST` **Путь:** `/api/admin/windows` **Описание:** Создание нового временного окна.

**Тело запроса (Request Body):**

- Передаются все поля, кроме `id`.
    

```
{
  "game_date": "2025-12-01",
  "time_start": "10:00:00",
  "time_end": "14:00:00"
}
```

**Тело ответа (Response Body - 201 Created):**

- Возвращает созданный объект `Окно`.
    

##### Удалить временное окно

**Метод:** `DELETE` **Путь:** `/api/admin/windows/<id>` **Описание:** Удаление временного окна.

**Тело ответа (Response Body - 204 No Content):**

- Успешное удаление.
    

### Обработка ошибок (Пример)

Для всех эндпоинтов, если что-то пошло не так (неверные данные, нет доступа, ресурс не найден), API должен возвращать соответствующий HTTP-статус и тело ответа в формате:

| HTTP Статус                   | Описание                                                | Пример тела ответа                                                       |
| ----------------------------- | ------------------------------------------------------- | ------------------------------------------------------------------------ |
| **400 Bad Request**           | Неверный формат данных или нехватка обязательных полей. | `{"error": "Validation failed", "details": "Field 'name' is required."}` |
| **404 Not Found**             | Ресурс с указанным ID не найден.                        | `{"error": "Task not found"}`                                            |
| **405 Method Not Allowed**    | Использован неверный HTTP-метод.                        | `{"error": "Method not allowed for this resource"}`                      |
| **500 Internal Server Error** | Непредвиденная ошибка на сервере.                       | `{"error": "Internal server error"}`                                     |